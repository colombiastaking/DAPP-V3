# 2026-02-17 Memory Log

## SDK v5 Migration COMPLETED

### Summary
Successfully migrated Colombia Staking Dapp from `@multiversx/sdk-dapp` v2.19.2 to v5.x (major version upgrade).

### Branch
- `migration/sdk-dapp-v5`

### Package Updates
- `@multiversx/sdk-core`: 15.3.2
- `@multiversx/sdk-dapp`: ^5.6.15
- `@multiversx/sdk-dapp-ui`: ^0.1.21
- `@multiversx/sdk-dapp-utils`: new dependency

### Key Files Created
- `src/index.tsx` - Added initApp() with walletConnectV2ProjectId under `providers.walletConnect`
- `src/App.tsx` - Removed DappProvider, NotificationModal, SignTransactionsModals, TransactionsToastList
- `src/pages/Unlock/Unlock.tsx` - Replaced individual login buttons with UnlockPanelManager
- `src/helpers/useTransaction.ts` - New transaction flow using Transaction class, getAccountProvider, TransactionManager
- `src/helpers/sendTransactions.ts` - Drop-in replacement for old sendTransactions API
- `src/helpers/useSendTransactions.ts` - Hook wrapper for sending transactions
- `src/hooks/useTransactionStatus.ts` - Compatibility hook wrapping useGetSuccessfulTransactions/useGetPendingTransactions
- `src/helpers/contractQuery.ts` - Adapter for Query → IContractQuery (Address.bech32() vs toBech32() mismatch)
- `src/helpers/parseAmount.ts` - Replacement for removed SDK utility
- `src/components/AuthenticatedRoutesWrapper.tsx` - Replacement for removed SDK component
- `src/helpers/fetchClaimableCols.ts` - Rewritten without ResultsParser (manually parses binary response)

### Breaking Changes Handled
1. **initApp()** - Must be called before React render, requires walletConnectV2ProjectId nested under `providers.walletConnect`
2. **UnlockPanelManager** - Replaced individual login buttons (LedgerButton, WalletConnectLoginButton, etc.)
3. **Transaction flow** - Changed from `sendTransactions()` to `provider.signTransactions()` + `txManager.send()` + `txManager.track()`
4. **Hook imports** - Changed from `@multiversx/sdk-dapp/hooks/*` to `@multiversx/sdk-dapp/out/react/*`
5. **Address API**:
   - `Address.fromBech32()` → `Address.newFromBech32()`
   - `.hex()` → `.toHex()`
   - `.bech32` → `.toBech32()`
   - `.pubkey` → `.getPublicKey()`
6. **Query → IContractQuery** - Created ContractQueryAdapter because sdk-core's Address has `toBech32()` but sdk-network-providers' IAddress expects `bech32()`
7. **TokenPayment removed** - Replaced with custom `egldToWei()` function
8. **ResultsParser removed** - Manually parse binary response data in fetchClaimableCols.ts
9. **useGetAccount** - Returns AccountType directly (not `{account}`), so `const account = useGetAccount(); const address = account.address;`
10. **useGetSuccessfulTransactions** - Returns array directly, not object - created useTransactionStatus compatibility hook
11. **NetworkSliceType** - Access chainId via `network.chainId` not directly

### Build Output
- `build/index.html` - 3.50 kB
- `build/assets/index-5602831e.css` - 78.05 kB
- `build/assets/index-5261532d.js` - 1,387.87 kB
- `build/assets/index-109e2ecc.js` - 3,392.17 kB

### Test Server
- Domain: test.colombia-staking.com
- Deployment: FTP (credentials needed from user)

### Next Steps
1. Test in dev mode (`npm run dev`)
2. Test login flow with all wallet providers
3. Test transaction flows (delegate, undelegate, claim rewards)
4. Test COLS staking functionality
5. Deploy to testnet for final verification

---